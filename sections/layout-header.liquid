<div x-data="{menu:false}" class="relative">
  <header class="leading-10 lg:leading-6 pt-10 lg:pt-20 pb-5 lg:pb-10 bg-background relative z-40">
    <div class="container mx-auto">
      <div class="flex justify-between gap-8">
        <nav @mouseleave.prevent="menu=false" @focusout="menu=false" class="hidden lg:flex gap-8 bg-background">
          {%- for link in section.settings.menu.links -%}
            {%- if link.links != blank -%}
              <button
                type="button"
                class="transition text-foreground hover:text-foreground-active hover:underline underline-offset-4 flex gap-2 items-center"
                @mouseenter.prevent="menu=true"
                @focus="menu=true"
                @click="window.location.href='{{ link.url }}'"
                aria-expanded="false"
                :aria-expanded="menu.toString()"
                aria-controls="dropdown-menu"
                id="menu-trigger"
              >
                {{ link.title | escape }}
                <span class="size-1.5 border border-foreground block rounded-full" aria-hidden="true"></span>
              </button>
            {%- else -%}
              <a
                class="transition text-foreground hover:text-foreground-active hover:underline underline-offset-4 flex gap-2 items-center"
                href="{{ link.url }}"
                {% if link.current %}aria-current="page"{% endif %}
              >
                {{ link.title | escape }}
              </a>
            {%- endif -%}
          {%- endfor -%}
        </nav>
        <nav class="flex-grow flex gap-8 justify-between lg:justify-end items-center">
          <button
            class="flex lg:hidden min-w-[44px] min-h-[44px] items-center justify-center rounded-lg"
            @click="$store.global.isMobileMenuVisible = !$store.global.isMobileMenuVisible"
            aria-label="Open menu"
            :aria-expanded="$store.global.isMobileMenuVisible.toString()"
          >
            {% render 'icon-hamburger' %}
          </button>
          <a class="transition text-foreground hover:text-foreground-active font-medium" href="/">{{ shop.name }}</a>
          <button
            class="flex items-center gap-2 min-h-[44px]"
            @click="minicart=true"
            aria-label="Open cart with {{ cart.item_count }} items"
          >
            <span>{{ 'templates.cart.cart' | t }}</span>
            <span class="text-xs font-medium cursor-pointer transition bg-background text-foreground hover:text-foreground-active inline-flex min-w-[24px] min-h-[24px] border border-foreground/50 rounded-lg justify-center items-center" aria-hidden="true">{{ cart.item_count }}</span>
            <span class="sr-only">{{ 'sections.header.cart_count' | t: count: cart.item_count }}</span>
          </button>
        </nav>
      </div>
    </div>
  </header>
  <div
    x-show="menu"
    x-transition:enter="transition ease duration-300"
    x-transition:enter-start="opacity-0 -translate-y-5"
    x-transition:enter-end="opacity-100 translate-y-0 "
    x-transition:leave="transition ease duration-300"
    x-transition:leave-start="opacity-100 translate-y-0"
    x-transition:leave-end="opacity-0 -translate-y-5 "
    @keydown.escape="menu=false"
    role="menu"
    aria-labelledby="menu-trigger"
    id="dropdown-menu"
    class="absolute inset-x-0 pb-10 bg-background top-full shadow-xl shadow-stone-500/10">
    <div
      class="container">
      {%- for link in section.settings.menu.links -%}
        <ul class="flex flex-col gap-1" role="none">
          {%- for child_link in link.links -%}
            <li role="none">
              <a href="{{ child_link.url }}" {% if child_link.active %}aria-current="page"{% endif %} role="menuitem">
                {{ child_link.title | escape }}
              </a>
            </li>
          {%- endfor -%}
        </ul>
      {%- endfor -%}
    </div>
  </div>
</div>

{% schema %}
{
  "name": "Header",
  "class":"lg:sticky top-0 group z-50",
  "settings": [
    {
      "type": "link_list",
      "id": "menu",
      "default": "main-menu",
      "label": "Primary navigation"
    },
    {
      "type": "checkbox",
      "id": "enable_sticky_header",
      "default": true,
      "label": "Enable sticky header",
      "info": "Header shows on the screen as customers scroll up."
    }
  ]
}
{% endschema %}