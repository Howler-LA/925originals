{% assign current_collection = collection.handle %}

{% if current_collection contains '-women' and card_product.metafields.media.womens %}
  {% for file in card_product.metafields.media.womens.value limit:1 %}
    {% assign alt_image = file %}
  {% endfor %}
{% elsif current_collection contains '-men' and card_product.metafields.media.mens %}
  {% for file in card_product.metafields.media.mens.value limit:1 %}
    {% assign alt_image = file %}
  {% endfor %}
{% elsif card_product.media[1] %}  
  {% assign alt_image = card_product.media[1] %}
{% endif %}

{% capture tags %}
  {% if card_product.tags.size > 0 %}
    {% for tag in card_product.tags %}
      {{ tag | downcase | replace: ' ', '-' }}
    {% endfor %}
  {% endif %}
{% endcapture %}

<article class="shrink-0 flex flex-col group {{ tags }}"
         data-product-id="{{ card_product.id }}"
         data-product-title="{{ card_product.title }}"
         data-product-type="{{ card_product.type }}"
         data-product-price="{{ card_product.price }}"
         data-product-created="{{ card_product.created_at }}">
  <a class="block" href="{{ card_product.url | within: collection }}">
    <div class="aspect-[4/5] transition duration-300 ease relative">
      <img
        width="{{ card_product.featured_image.width }}"
        height="{{ card_product.featured_image.height }}"
        src="{{ card_product.featured_image | image_url: width: 900 }}"
        srcset="{{ card_product.featured_image | image_url: width: 205 }} 1x, {{ card_product.featured_image | image_url: width: 900 }} 2x"
        alt="{{ card_product.featured_image.alt }}"
        class="absolute inset-0 object-contain h-full transition ease duration-500"
        loading="lazy"
      >

      {% if alt_image %}
        <div class="absolute inset-0 bg-stone-50 opacity-0 group-hover:opacity-100 transition ease duration-500">
          <img
            width="{{ card_product.media[1].width }}"
            height="{{ card_product.media[1].height }}"
            src="{{ alt_image | image_url: width: 900 }}"
            srcset="{{alt_image | image_url: width: 205 }} 1x, {{ alt_image | image_url: width: 900 }} 2x"
            alt="{{ card_product.media[1].alt }}"
            class="absolute inset-0 object-contain h-full transition ease duration-500"
            loading="lazy"
          >
        </div>
      {% endif %}

    </div>
  </a>
  <header class="flex pt-4">
    <div class="flex-grow">
      <h3 class="text-black font-bold capitalize text-lg font-narrow tracking-tight">{{ card_product.title | downcase }}</h3>
      {% if card_product.options contains 'Color' %}
        <div class="text-subtle ease transition duration-300">
          {% assign color_index = nil %}
          {% for option in card_product.options %}
            {% if option == 'Color' %}
              {% assign color_index = forloop.index0 %}
            {% endif %}
          {% endfor %}
          {% assign color_values = '' %}
          {% for variant in card_product.variants %}
            {% assign color = variant.options[color_index] %}
            {% unless color_values contains color %}
              {% assign color_values = color_values | append: color | append: ', ' %}
            {% endunless %}
          {% endfor %}
          {{ color_values | split: ', ' | uniq | join: ', ' | strip }}
        </div>
      {% endif %}
    </div>
    <div class="text-right ease transition duration-300">
      <div class="tracking-tight relative font-bold font-narrow capitalize text-lg">
        {% render 'price' product: card_product %}
      </div>
    </div>
  </header>
</article>